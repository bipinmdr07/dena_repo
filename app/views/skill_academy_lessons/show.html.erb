<% title(get_lesson_name(controller_name.classify.underscore, params[:id]) + " | TECHRISE") %>

<style type="text/css">
.course_html {
  background: white;
}
</style>


<div class="row">
  <!-- sidebar -->
  <div class="col-lg-3 visible-lg">
    <div style="width: 100%">
      <div id="sidebar_container" data-spy="affix" data-offset-bottom="40">
        <%= render 'sidebar' %>
      </div>
    </div>
  </div>

  <div class="col-lg-9 col-md-12">

    <section class="lesson_content">

      <%= render partial: '/cards/widget' %>

      <%= render file: "app/views/#{@current_course_link}/lessons/lesson_#{@current_lesson_id}" %>

      <br class = "clear">

      <div class="hint-prompt">
        <h5>Think you have the solution?</h5>
        <button class="btn btn-gotcha" data-gotcha-id="1"><i class="fa fa-check" aria-hidden="true"></i> I've solved it myself</button>
        <button class="btn btn-hint" data-hint-id="1"><i class="fa fa-question" aria-hidden="true"></i> Give me a hint!</button>
      </div>

      <br class = "clear">

      <%= render 'lesson_nav_section' %>

      <%= render partial: '/submissions/for_lesson' if @submission_form %>

      <%= render partial: '/questions/for_lesson' %>

      <%= render 'git_workflow_modal' %>

    </section>

  </div>

</div>

<script type="text/javascript">
var hints;
var hints = {
  show_next: function(el, dataEl){
    var id, content, hint_id, content_class_name;

    id = el.data(dataEl);
    next_id = id + 1;

    // get class name of element to display
    content_class_name = dataEl.slice(0, -3);

    content = $("." + content_class_name +  "[data-" + dataEl + "=" + id + "]");

    this.show_hint(content);

    // update data-hint-id of hint button
    el.data(dataEl, next_id);

    // if there are no more hints, disable button
    if ($("." + content_class_name +  "[data-" + dataEl + "=" + next_id + "]").length === 0) {    
      el.prop("disabled", true);
      hints.show_all();
    }

    this.scroll_to(content);
  },
  show_all: function(){
    this.show_hint($(".hint"));
    this.show_hint($(".gotcha"));
    $(".btn-hint").prop("disabled", true);
    $(".btn-gotcha").prop("disabled", true);
    this.scroll_to($(".hint")[0]);    
    return;
  },
  show_hint: function(el){
    el.fadeIn();
    el.addClass("hint-activated");
    window.setTimeout(function(){
      el.removeClass("hint-activated");
    }, 10000);
  },
  scroll_to: function(el) {
    $('html,body').animate({ 
        scrollTop: el.offset().top - 50
    }, 800);
  }
}  


$(".btn-gotcha").on("click", function(){
  hints.show_next($(this), "gotcha-id");  
});

$(".btn-hint").on("click", function(){
  hints.show_next($(this), "hint-id");
});

$(document).on('turbolinks:load', show_page_trigger);
</script>
