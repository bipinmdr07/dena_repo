<style type="text/css" media="screen">
    #editor { 
      height: 300px;
    }
</style>

<div class="devise_box">
  <h4 class="pull-left"><%= link_to '<< Back to Lessons', courses_path %></h4>
  <h4 class="pull-right"><%= pluralize(cards.count, 'card') %> left for today!</h4>
  <hr class="clear">

  <div class="row">
    <div class="col-xs-12 col-sm-6">
      <%= sanitize card.question %>
    </div>

    <div class="col-xs-12 col-sm-6">
      <div class="panel panel-default">
        <div class="panel-heading" style="background: #0F0F0F; color: white;">
            <h3 class="panel-title">Type your answer below:</h3>
        </div>
        <div class="panel-body" style="background-color: #0F0F0F;">
            <div id="editor">
            </div>
        </div>
      </div><!-- panel panel-default -->
    </div><!-- col-xs-12 col-sm-6 -->
  </div><!-- row -->

  
  <button type="button" class="btn btn-primary">Check Answer</button>

  <div class="check_answer">
    <h2>Answer:</h2>

    <div class="col-xs-12 col-sm-6">
      <%= sanitize card.answer %>
    </div>

    <div class="col-xs-12 col-sm-6">
      <div class="well">
        <h3>Related Resources</h3>
        <ul>
          <% card.tag_list.each do |tag| %>
            <% links = Tags.get_links(tag) %>
            <% links.each do |link| %>
              <li><%= link_to link[1], '/' + link[0] %></li>
            <% end %>
          <% end %>
        </ul>
      </div>
    </div>

    <h3>Rate your understanding <small>(0: I don't get this at all, 5: I'm a master)</small></h3>

    <div style="margin: 30px auto 30px;display: table;">
      <%= simple_form_for card, url: update_interval_path(card.id), method: :put, remote: true do |f| %>
        <%= f.input :quality_response, collection: 0..5, as: :radio_buttons, item_wrapper_class: 'inline', label: false, required: true %> 
        <%= f.submit 'Submit', class: 'btn btn-primary', style: 'margin: 0 auto; display: block;' %>
      <% end %>
    </div>
    

  </div><!-- check_answer -->

</div><!-- devise_box -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/ace.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
    var editor = ace.edit("editor");
    editor.setOptions({
      maxLines: 100,
      tabSize: 2,
      useSoftTabs: true,
      displayIndentGuides: true
    });
    editor.setTheme("ace/theme/vibrant_ink");

    <% if card.question.include?("<code class='ruby'>") %>
      editor.session.setMode("ace/mode/ruby");
    <% elsif card.question.include?("<code class='javascript'>") %>
      editor.session.setMode("ace/mode/javascript");
    <% end %>

    $('button').on('click', function(){
      $('.check_answer').toggle();
      $('button').hide();
      var own_answer = document.getElementById("answer").value;
      $('#own_answer').text("Your answer: \n" + editor.getValue());
    })
</script>