<script type="text/javascript">
if (!window.x) {
    x = {};
}

x.Selector = {};
x.Selector.getSelected = function() {
    var t = '';
    if (window.getSelection) {
        t = window.getSelection();
    } else if (document.getSelection) {
        t = document.getSelection();
    } else if (document.selection) {
        t = document.selection.createRange().text;
    }
    return t;
}

var pageX;
var pageY;

$(document).ready(function() {
    $(document).bind("mouseup", function() {
        var selectedText = x.Selector.getSelected();
        if(selectedText != ''){
          // document.getElementById("mytext").value = selectedText;
            $('ul.selText').css({
                'left': pageX + 0,
                'top' : pageY - 0
            }).fadeIn(200);
        } else {
            $('ul.selText').fadeOut(200);
        }
    });
    $(document).on("mousedown", function(e){
        pageX = e.pageX;
        pageY = e.pageY;
    });
});


$(document).on("click", ".openFeedback", function () {
     var selectedText = x.Selector.getSelected();
     var userId = <%= current_user.id %>;
     var lesson_id = <%= params[:id] %>;
     var course_name = "<%= controller_name.classify.constantize %>";
     $(".modal-body #feedback_content").val( selectedText );
     $(".modal-body #feedback_user_id").val( userId );
     $(".modal-body #feedback_lesson_id").val( lesson_id );
     $(".modal-body #feedback_course_name").val( course_name );

});
</script>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"S>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Feedback</h4>
      </div>
      <div class="modal-body">
        <%= simple_form_for :feedback, url: feedbacks_path, method: :post, input_html: {class: 'form-horizontal'} do |f| %>
          <%= f.input :title, required: true %>
          <%= f.input :content, input_html: {rows: 6, readonly: :true}, required: true  %>
          <%= f.input :user_id, as: :hidden, required: true %>
          <%= f.input :course_name, as: :hidden, required: true %>
          <%= f.input :lesson_id, as: :hidden, required: true %>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <%= f.submit 'Submit Question', class: 'btn btn-primary' %>
        </div>
      <% end %>
    </div>
  </div>
</div>


<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#myModal">
 Send feedback
</button>

<ul class="selText">
    <a data-toggle="modal" title="Send Feedback" class="openFeedback btn btn-primary" href="#myModal">Test</a>
</ul>

<%= current_user.id %>
 <input type="text" name="user" id="mytext">
 <input type="submit" value="Submit">
