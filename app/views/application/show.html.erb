<% title(Tags::LESSONS[controller_name.classify.underscore + "s"].keys[params[:id].to_i - 1][1] + " | TECHRISE") %>

<style type="text/css">
.course_html {
  background: white;
}
</style>


<div class="row">
  <!-- sidebar -->
  <div class="col-lg-3 visible-lg">
      <div id="sidebar_container">
        <%= render 'sidebar' %>
      </div>
  </div>

  <div class="col-lg-9 col-md-12">

    <section class="lesson_content">

      <%= render partial: '/cards/widget' %>

      <%= render file: "app/views/#{@course_link}/lessons/lesson_#{@lesson}" %>
      <br class = "clear">

      <%= render 'lesson_nav_section' %>

      <%= render partial: '/submissions/for_lesson' if @submission_form %>

      <%= render partial: '/questions/for_lesson' %>

      <%= render 'git_workflow_modal' %>

    </section>

  </div>

</div>

<script type="text/javascript">

$(function(){
  // lock lesson nav
  var windw = this;
  var pos;

  $.fn.followTo = function ( elem ) {
    var $this = this,
        $window = $(windw),
        $bumper = $(elem),
        bumperPos = $bumper.offset().top,
        thisHeight = $this.outerHeight(),
        setPosition = function(){
            if ($window.scrollTop() > (bumperPos - thisHeight)) {
                $this.css({
                    position: 'absolute',
                    top: (bumperPos - thisHeight)
                });
            } else {
                $this.css({
                    position: 'fixed',
                    top: 0
                });
            }
        };
      $window.resize(function()
      {
          bumperPos = pos.offset().top;
          thisHeight = $this.outerHeight();
          setPosition();
      });
      $window.scroll(setPosition);
      setPosition();      
  };

  $('#header').followTo('#sidebar_container');

  $('#header').followTo('#slider');
})

var wrap = $("#wrap");
var sidebar = $("#sidebar");
var handle = $(".handle");

$(document).bind('scroll', function() {
   if ($(window).scrollTop() > 10) {
    sidebar.addClass("fixed-sidebar");
    handle.addClass("fixed-handle");
  } else {
    sidebar.removeClass("fixed-sidebar");
    handle.removeClass("fixed-handle");
  }
});


// add .active to current lesson
var url = window.location;
// Will only work if string in href matches with location
$('ul.nav a[href="'+ url +'"]').parent().addClass('active');

// Will also work for relative and absolute hrefs
$('ul.nav a').filter(function() {
    return this.href == url
}).parent().addClass('active');

// scroll to current lesson
var ready;
ready = function() {

  var target = document.getElementsByClassName("active");
  target[0].parentNode.scrollTop = target[0].offsetTop; 

  $("#slider").slideReveal({
    trigger: $(".trigger"),
    position: "right",
    width: 350,
    speed: 700,
    top: 0
  });

};

$(document).ready(ready);
$(document).on('page:load', ready);

</script>